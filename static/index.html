<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KrishiSakhiAI â€” Smart Farming Assistant</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ¾</text></svg>">
</head>
<body>
<div class="app">

  <!-- â•â• ICON RAIL â•â• -->
  <nav class="icon-rail">
    <div class="rail-brand">ğŸŒ¾</div>
    <div class="rail-links">
      <button class="rail-btn active" id="rb-chat" onclick="setMode('chat')" title="Chat Assistant">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
        <span>Chat</span>
      </button>
      <button class="rail-btn" id="rb-livestock" onclick="setMode('livestock')" title="Livestock Hub">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="7" r="4"/><path d="M20 21a8 8 0 10-16 0"/></svg>
        <span>Livestock</span>
      </button>
    </div>
    <div class="rail-foot">
      <button class="rail-btn" onclick="clearChat()" title="Clear Chat">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
        <span>Clear</span>
      </button>
    </div>
  </nav>

  <!-- â•â• SIDEBAR â•â• -->
  <aside class="sidebar" id="sidebar">
    <div class="sb-header">
      <div class="sb-title">KrishiSakhiAI</div>
      <div class="sb-ver">v2.0</div>
    </div>

    <div id="statusBadges">
      <div class="status-badge" id="ollamaStatus"><span class="dot dot-idle"></span>Checkingâ€¦</div>
    </div>

    <div id="farmerSidebar" style="display:none;"></div>

    <div id="modeSelector" style="display:none;">
      <div class="sb-label">Mode</div>
      <div class="seg-group">
        <button class="seg-btn active" data-mode="chat" onclick="setMode('chat')">ğŸ’¬ Chat</button>
        <button class="seg-btn" data-mode="livestock" onclick="setMode('livestock')">ğŸ„ Livestock</button>
      </div>
    </div>

    <div id="modelSelector" style="display:none;">
      <div class="sb-label">AI Model</div>
      <select class="sb-select" id="modelSelect"></select>
    </div>

    <div id="langSelector" style="display:none;">
      <div class="sb-label">Language / à¤­à¤¾à¤·à¤¾</div>
      <select class="sb-select" id="langSelect" onchange="onLangChange()">
        <option value="English">ğŸ‡¬ğŸ‡§ English</option>
        <option value="Hindi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤‚à¤¦à¥€ (Hindi)</option>
        <option value="Marathi">à¤®à¤°à¤¾à¤ à¥€ (Marathi)</option>
      </select>
    </div>

    <div>
      <div class="sb-label">Creativity &nbsp;<span class="temp-chip" id="tempVal">0.70</span></div>
      <div class="slider-extremes"><span>Precise</span><span>Creative</span></div>
      <input type="range" class="sb-range" min="0" max="1" step="0.05" value="0.7" id="temperature"
        oninput="document.getElementById('tempVal').textContent=parseFloat(this.value).toFixed(2)">
    </div>

    <div style="flex:1;"></div>
    <button class="sb-btn-danger" id="resetProfileBtn" style="display:none;" onclick="resetProfile()">â†º Reset Profile</button>
    <div class="sb-footer">FastAPI Edition</div>
  </aside>

  <!-- â•â• MAIN â•â• -->
  <main class="main" id="mainArea">

    <!-- PAGE: REGISTER -->
    <div class="page active" id="pageRegister">
      <div class="ob-shell">
        <div class="ob-progress">
          <div class="ob-step active"><div class="ob-dot">1</div><span>Profile</span></div>
          <div class="ob-line"></div>
          <div class="ob-step"><div class="ob-dot">2</div><span>Crops</span></div>
          <div class="ob-line"></div>
          <div class="ob-step"><div class="ob-dot">3</div><span>Diseases</span></div>
        </div>

        <div class="ob-hero">
          <div class="ob-tag">ğŸŒ¾ Smart Farming Platform</div>
          <h1>Welcome to KrishiSakhiAI</h1>
          <p>AI-powered farming companion for Maharashtra. Get personalized advice on crops, pests, livestock & markets.</p>
        </div>

        <div class="w-card">
          <div class="w-card-head">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            Farmer Registration
          </div>
          <div class="form-grid-2">
            <div class="fg"><label>Full Name <span class="req">*</span></label><input class="fi" id="regName" placeholder="e.g. Rajesh Patil"></div>
            <div class="fg"><label>Phone Number <span class="req">*</span></label><input class="fi" id="regPhone" placeholder="10-digit mobile" maxlength="10"></div>
            <div class="fg"><label>Land Size (Acres)</label><input type="number" class="fi" id="regLand" value="5" min="0.1" step="0.5"></div>
            <div class="fg"><label>Region (Maharashtra)</label><select class="fi" id="regRegion"></select></div>
            <div class="fg"><label>Primary Water Source</label>
              <select class="fi" id="regWater">
                <option>ğŸ”ï¸ Well / Borewell</option><option>ğŸï¸ Canal</option>
                <option>ğŸŒŠ River / Stream</option><option>ğŸŒ§ï¸ Rainfed only</option>
                <option>ğŸ—ï¸ Farm Pond</option><option>ğŸš° Drip / Sprinkler</option>
              </select>
            </div>
            <div class="fg"><label>Current Crop(s)</label><input class="fi" id="regCrop" placeholder="e.g. Sugarcane, Onion, Wheat"></div>
          </div>
          <div id="regError" class="alert alert-red" style="display:none;"></div>
          <button class="btn-primary w-full" style="margin-top:1.5rem;" onclick="submitRegistration()">
            Continue to Crop Planning â†’
          </button>
        </div>
      </div>
    </div>

    <!-- PAGE: CROP PLAN -->
    <div class="page" id="pageCropPlan">
      <div class="ob-shell">
        <div class="ob-progress">
          <div class="ob-step done"><div class="ob-dot">âœ“</div><span>Profile</span></div>
          <div class="ob-line filled"></div>
          <div class="ob-step active"><div class="ob-dot">2</div><span>Crops</span></div>
          <div class="ob-line"></div>
          <div class="ob-step"><div class="ob-dot">3</div><span>Diseases</span></div>
        </div>
        <div id="cropPlanContent"></div>
        <div class="ob-nav">
          <button class="btn-outline" onclick="goStep(1)">â† Back</button>
          <button class="btn-primary" onclick="goStep(3)">Explore Rare Crops â†’</button>
        </div>
      </div>
    </div>

    <!-- PAGE: RARE CROPS -->
    <div class="page" id="pageRareCrops">
      <div class="ob-shell">
        <div class="ob-progress">
          <div class="ob-step done"><div class="ob-dot">âœ“</div><span>Profile</span></div>
          <div class="ob-line filled"></div>
          <div class="ob-step done"><div class="ob-dot">âœ“</div><span>Crops</span></div>
          <div class="ob-line filled"></div>
          <div class="ob-step active"><div class="ob-dot">3</div><span>Diseases</span></div>
        </div>
        <div id="rareCropContent"></div>
        <div class="ob-nav">
          <button class="btn-outline" onclick="goStep(2)">â† Back</button>
          <button class="btn-primary" onclick="completeOnboarding()">âœ… Enter KrishiSakhiAI â†’</button>
        </div>
      </div>
    </div>

    <!-- PAGE: CHAT -->
    <div class="page" id="pageChat">
      <div class="page-topbar">
        <div class="topbar-left">
          <span class="topbar-icon">ğŸŒ¾</span>
          <div>
            <div class="topbar-name">KrishiSakhi</div>
            <div class="topbar-sub">AI Agricultural Assistant</div>
          </div>
        </div>
        <div class="topbar-right">
          <div class="pill-tabs">
            <button class="pill-tab active" data-mode="chat" onclick="setMode('chat')">ğŸ’¬ Chat</button>
            <button class="pill-tab" data-mode="livestock" onclick="setMode('livestock')">ğŸ„ Livestock</button>
          </div>
          <label class="kb-toggle">
            <input type="checkbox" id="kbToggle" checked>
            <span class="kb-track"><span class="kb-thumb"></span></span>
            <span class="kb-label">Knowledge Base</span>
          </label>
        </div>
      </div>

      <div class="chat-layout">
        <div class="chat-main">
          <div class="chat-messages" id="chatMessages">
            <div class="welcome-box">
              <div class="welcome-badge">ğŸ™ Namaste!</div>
              <h2>Welcome to KrishiSakhiAI</h2>
              <p>Your AI-powered farming companion. Ask me about crops, pests, soil health, livestock, or market prices!</p>
              <div class="chip-row">
                <button class="chip" onclick="useChip(this)">ğŸŒ± Best kharif crops for my region?</button>
                <button class="chip" onclick="useChip(this)">ğŸ› How to control aphids organically?</button>
                <button class="chip" onclick="useChip(this)">ğŸ’§ Drip irrigation setup guide</button>
                <button class="chip" onclick="useChip(this)">ğŸ“ˆ Current MSP rates for wheat?</button>
              </div>
            </div>
          </div>

          <div id="imageUploadArea" style="padding:0 1.5rem 0;">
            <div id="imagePreview" style="display:none; margin-bottom:0.5rem;"></div>
          </div>

          <div class="chat-bar">
            <input type="file" accept="image/*" id="chatImageFile" style="display:none" onchange="previewImage(this)">
            <button class="bar-icon-btn" onclick="document.getElementById('chatImageFile').click()" title="Upload image">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
            </button>
            <input class="chat-input" id="chatInput" placeholder="Ask about crops, pests, soil, livestockâ€¦"
              onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage()}">
            <button class="btn-send" id="chatSendBtn" onclick="sendMessage()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
              Send
            </button>
          </div>
        </div>

        <!-- Right summary panel -->
        <div class="summary-panel">
          <div class="sp-section">
            <div class="sp-title">Farm Overview</div>
            <div class="sp-card">
              <div class="sp-label">Current Season</div>
              <div class="sp-value" id="cspSeasonVal">â€”</div>
            </div>
            <div class="sp-card">
              <div class="sp-label">Your Region</div>
              <div class="sp-value" id="cspRegionVal">â€”</div>
            </div>
            <div class="sp-card">
              <div class="sp-label">AI Status</div>
              <div class="sp-value" id="cspAiStatus" style="color:#f59e0b;">Connectingâ€¦</div>
            </div>
          </div>
          <div class="sp-divider"></div>
          <div class="sp-section">
            <div class="sp-title">Farming Tips</div>
            <div class="tip-item">ğŸŒ§ï¸ Check soil moisture before irrigation</div>
            <div class="tip-item">ğŸ› Scout fields every 7 days for pests</div>
            <div class="tip-item">ğŸŒ¡ï¸ Monitor THI for heat stress in cattle</div>
            <div class="tip-item">ğŸ’Š Keep vaccination records updated</div>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE: LIVESTOCK -->
    <div class="page" id="pageLivestock">
      <div class="page-topbar">
        <div class="topbar-left">
          <span class="topbar-icon">ğŸ„</span>
          <div>
            <div class="topbar-name">Livestock Biosecurity Hub</div>
            <div class="topbar-sub">AI diagnostics Â· Vaccination Â· Diet Â· Inputs Â· Emergency</div>
          </div>
        </div>
        <div class="topbar-right">
          <div class="pill-tabs">
            <button class="pill-tab" data-mode="chat" onclick="setMode('chat')">ğŸ’¬ Chat</button>
            <button class="pill-tab active" data-mode="livestock" onclick="setMode('livestock')">ğŸ„ Livestock</button>
          </div>
        </div>
      </div>

      <div class="ls-tabbar">
        <button class="ls-tab active" onclick="switchLsTab(0)">ğŸ”¬ Health Scanner</button>
        <button class="ls-tab" onclick="switchLsTab(1)">ğŸ’‰ Vaccination</button>
        <button class="ls-tab" onclick="switchLsTab(2)">ğŸ¥¬ Feed & Diet</button>
        <button class="ls-tab" onclick="switchLsTab(3)">ğŸšœ Farm Inputs</button>
        <button class="ls-tab" onclick="switchLsTab(4)">ğŸš‘ Emergency Vet</button>
      </div>

      <div class="ls-body">

        <!-- TAB 0 -->
        <div class="ls-panel active" id="lsTab0">
          <div class="scan-toggle-bar">
            <button class="mode-tab active" onclick="switchScanMode('manual',this)">ğŸ“ Manual Input</button>
            <button class="mode-tab" onclick="switchScanMode('csv',this)">ğŸ“ Upload CSV</button>
          </div>

          <div id="scanManual">
            <div class="sensor-block">
              <div class="sensor-block-title">ğŸŒ¡ï¸ Physiological Sensors</div>
              <div class="sensor-grid-5">
                <div class="fg"><label>Body Temp Â°C <span class="nr">38.3â€“39.4</span></label><input type="number" class="fi" id="s_body_temp" value="38.8" step="0.1"></div>
                <div class="fg"><label>Heart Rate bpm <span class="nr">40â€“80</span></label><input type="number" class="fi" id="s_heart_rate" value="60"></div>
                <div class="fg"><label>Resp. Rate /min <span class="nr">15â€“30</span></label><input type="number" class="fi" id="s_respiratory_rate" value="22"></div>
                <div class="fg"><label>Activity % <span class="nr">50â€“85</span></label><input type="number" class="fi" id="s_activity_level" value="68"></div>
                <div class="fg"><label>Milk Yield L/day <span class="nr">12â€“30</span></label><input type="number" class="fi" id="s_milk_yield" value="20" step="0.5"></div>
              </div>
            </div>
            <div class="sensor-block">
              <div class="sensor-block-title">ğŸ”„ Activity & Intake</div>
              <div class="sensor-grid-5">
                <div class="fg"><label>Rumination min <span class="nr">380â€“520</span></label><input type="number" class="fi" id="s_rumination_min" value="450"></div>
                <div class="fg"><label>Feed Intake kg <span class="nr">18â€“28</span></label><input type="number" class="fi" id="s_feed_intake" value="22" step="0.5"></div>
                <div class="fg"><label>Water Intake L <span class="nr">40â€“80</span></label><input type="number" class="fi" id="s_water_intake" value="55"></div>
                <div class="fg"><label>Lying Time hrs <span class="nr">10â€“14</span></label><input type="number" class="fi" id="s_lying_time" value="12" step="0.5"></div>
                <div class="fg"><label>Steps /day <span class="nr">2000â€“5000</span></label><input type="number" class="fi" id="s_steps_count" value="3500"></div>
              </div>
            </div>
            <div class="sensor-block">
              <div class="sensor-block-title">ğŸ¦¿ Gait & Environment</div>
              <div class="sensor-grid-5">
                <div class="fg"><label>Gait Score 1â€“5 <span class="nr">1=Normal</span></label><input type="number" class="fi" id="s_gait_score" value="1.2" step="0.1"></div>
                <div class="fg"><label>Stance Symmetry <span class="nr">1.0=perfect</span></label><input type="number" class="fi" id="s_stance_symmetry" value="0.95" step="0.01"></div>
                <div class="fg"><label>Stride Length m <span class="nr">1.4â€“1.7</span></label><input type="number" class="fi" id="s_stride_length" value="1.5" step="0.05"></div>
                <div class="fg"><label>Ambient Temp Â°C</label><input type="number" class="fi" id="s_ambient_temp" value="30" step="0.5"></div>
                <div class="fg"><label>Humidity %</label><input type="number" class="fi" id="s_humidity_pct" value="65"></div>
              </div>
            </div>
            <button class="btn-primary w-full" style="padding:0.9rem;font-size:1rem;margin-top:0.5rem;" onclick="runScan()">ğŸ”¬ Run Biosecurity Scan</button>
          </div>

          <div id="scanCsv" style="display:none;">
            <div class="upload-box">
              <div class="upload-icon">ğŸ“</div>
              <p>Upload a CSV with sensor readings</p>
              <small>Required columns: body_temp, heart_rate, respiratory_rate, activity_level, rumination_min, feed_intake, water_intake, milk_yield, lying_time, steps_count, gait_score, stance_symmetry, stride_length, ambient_temp, humidity_pct</small>
              <input type="file" accept=".csv" id="csvFile" style="display:none" onchange="uploadCsv()">
              <button class="btn-primary" style="margin-top:1rem;" onclick="document.getElementById('csvFile').click()">ğŸ“¤ Choose CSV File</button>
            </div>
          </div>
          <div id="scanResults"></div>
        </div>

        <!-- TAB 1 -->
        <div class="ls-panel" id="lsTab1">
          <div class="w-card">
            <div class="w-card-head">ğŸ’‰ Log Vaccination / Medicine</div>
            <div class="form-grid-3">
              <div class="fg"><label>Animal ID</label><input class="fi" id="vaxAnimal" placeholder="e.g. COW-001"></div>
              <div class="fg"><label>Record Type</label><select class="fi" id="vaxType"><option>Vaccination</option><option>Deworming</option><option>Medicine</option><option>Supplement</option></select></div>
              <div class="fg"><label>Vaccine / Medicine</label><input class="fi" id="vaxName" placeholder="e.g. FMD Vaccine"></div>
              <div class="fg"><label>Dosage</label><input class="fi" id="vaxDose" placeholder="e.g. 5ml IM"></div>
              <div class="fg"><label>Date Administered</label><input type="date" class="fi" id="vaxDate"></div>
              <div class="fg"><label>Veterinarian</label><input class="fi" id="vaxVet" placeholder="Dr. Name"></div>
            </div>
            <div class="fg"><label>Notes</label><textarea class="fi ft" id="vaxNotes" placeholder="Batch number, reactions, withdrawal periodâ€¦"></textarea></div>
            <button class="btn-primary" style="margin-top:1rem;" onclick="saveVax()">ğŸ’¾ Save Record</button>
          </div>
          <div class="section-label">ğŸ“‹ Indian Vaccination Schedule</div>
          <div id="vaxScheduleTable"></div>
          <div id="vaxRecords" style="margin-top:1.5rem;"></div>
        </div>

        <!-- TAB 2 -->
        <div class="ls-panel" id="lsTab2">
          <div class="w-card">
            <div class="w-card-head">ğŸ¥¬ Log Daily Diet</div>
            <div class="form-grid-3">
              <div class="fg"><label>Animal / Group</label><input class="fi" id="dietAnimal" placeholder="e.g. COW-001 or Herd A"></div>
              <div class="fg"><label>Date</label><input type="date" class="fi" id="dietDate"></div>
              <div class="fg"><label>Lactation Stage</label><select class="fi" id="dietLact"><option>Early (0-100 days)</option><option>Mid (100-200 days)</option><option>Late (200-305 days)</option><option>Dry Period</option></select></div>
              <div class="fg"><label>ğŸŒ¿ Green Fodder kg</label><input type="number" class="fi" id="dietGreen" value="30"></div>
              <div class="fg"><label>ğŸŒ¾ Dry Fodder kg</label><input type="number" class="fi" id="dietDry" value="6"></div>
              <div class="fg"><label>ğŸŒ½ Concentrates kg</label><input type="number" class="fi" id="dietConc" value="3"></div>
              <div class="fg"><label>ğŸ’§ Water L</label><input type="number" class="fi" id="dietWater" value="60"></div>
              <div class="fg"><label>Notes</label><input class="fi" id="dietNotes" placeholder="e.g. Added mineral mix"></div>
            </div>
            <button class="btn-primary" style="margin-top:1rem;" onclick="saveDiet()">ğŸ’¾ Save Diet Log</button>
          </div>
          <div class="section-label">ğŸ“Š Recommended Daily Diet â€” Dairy Cow</div>
          <div id="dietRefTable"></div>
          <div id="dietRecords" style="margin-top:1.5rem;"></div>
        </div>

        <!-- TAB 3 -->
        <div class="ls-panel" id="lsTab3">
          <div class="w-card" style="margin-bottom:1rem;">
            <div class="w-card-head">ğŸšœ Irrigation Setup</div>
            <div class="form-grid-3">
              <div class="fg"><label>Irrigation Type</label><select class="fi" id="irrType"><option>Drip</option><option>Sprinkler</option><option>Flood/Surface</option><option>Furrow</option><option>Rainfed</option></select></div>
              <div class="fg"><label>Water Source</label><input class="fi" id="irrSource" placeholder="e.g. Borewell"></div>
              <div class="fg"><label>Frequency</label><select class="fi" id="irrFreq"><option>Daily</option><option>Alternate days</option><option>Weekly</option><option>As needed</option></select></div>
            </div>
          </div>
          <div class="w-card">
            <div class="w-card-head">ğŸ§ª Log Pesticide / Fertilizer</div>
            <div class="form-grid-3">
              <div class="fg"><label>Type</label><select class="fi" id="fiType"><option>Pesticide</option><option>Fertilizer</option><option>Herbicide</option><option>Bio-pesticide</option></select></div>
              <div class="fg"><label>Product Name</label><input class="fi" id="fiName" placeholder="e.g. Imidacloprid 17.8SL"></div>
              <div class="fg"><label>Dosage</label><input class="fi" id="fiDose" placeholder="e.g. 0.5ml/L"></div>
              <div class="fg"><label>Field / Plot</label><input class="fi" id="fiField" placeholder="e.g. Plot A"></div>
              <div class="fg"><label>Date Applied</label><input type="date" class="fi" id="fiDate"></div>
              <div class="fg"><label>PHI (days)</label><input type="number" class="fi" id="fiPhi" value="14"></div>
            </div>
            <div class="fg"><label>Safety Notes</label><textarea class="fi ft" id="fiNotes" placeholder="PPE used, re-entry intervalâ€¦"></textarea></div>
            <button class="btn-primary" style="margin-top:1rem;" onclick="saveFarmInput()">ğŸ’¾ Save Record</button>
          </div>
          <div class="section-label">âš ï¸ MRL Guidelines</div>
          <div id="mrlTable"></div>
          <div id="farmInputRecords" style="margin-top:1.5rem;"></div>
        </div>

        <!-- TAB 4 -->
        <div class="ls-panel" id="lsTab4">
          <div class="emergency-card">
            <div class="em-icon">ğŸš¨</div>
            <div>
              <div class="em-title">Emergency Helplines</div>
              <div class="em-num">ğŸ“ 1962 â€” National Animal Helpline</div>
              <div class="em-sub">ğŸ“ 1800-121-3456 â€” NDDB Dairy (Toll-free)</div>
            </div>
          </div>
          <div class="w-card" style="margin-bottom:1rem;">
            <div class="w-card-head">ğŸ—ºï¸ Find Nearest Vet</div>
            <div class="form-grid-2">
              <div class="fg"><label>Your Location / Village / Pincode</label><input class="fi" id="vetLocation" placeholder="e.g. Nashik, Maharashtra"></div>
              <div class="fg" style="display:flex;align-items:flex-end;"><button class="btn-primary w-full" onclick="findVet()">ğŸ” Search Nearby Vets</button></div>
            </div>
            <div id="vetResults"></div>
          </div>
          <div class="section-label">ğŸ©º First Aid Quick Guide</div>
          <div id="firstAidTable"></div>
          <div class="section-label" style="margin-top:1.5rem;">ğŸ“š Veterinary Resources</div>
          <div id="vetResourcesTable"></div>
        </div>
      </div>
    </div>

  </main>
</div>

<script src="/static/app.js"></script>
<script>
  function useChip(el) {
    document.getElementById('chatInput').value = el.textContent.trim();
    document.getElementById('chatInput').focus();
  }
  // Patch completeOnboarding to update summary panel
  const _oc = window.completeOnboarding;
  window.completeOnboarding = function() {
    _oc && _oc();
    const fp = JSON.parse(localStorage.getItem('farmerProfile') || 'null');
    if (fp) {
      const rv = document.getElementById('cspRegionVal');
      if (rv) rv.textContent = fp.region || 'â€”';
    }
    const month = new Date().getMonth();
    const seasons = ['Rabi','Rabi','Rabi','Summer','Summer','Kharif','Kharif','Kharif','Kharif','Rabi','Rabi','Rabi'];
    const sv = document.getElementById('cspSeasonVal');
    if (sv) sv.textContent = seasons[month] + ' Season';
    // Sync icon rail
    syncRail('chat');
  };
  function syncRail(mode) {
    document.querySelectorAll('.rail-btn').forEach(b => b.classList.remove('active'));
    const rb = document.getElementById('rb-' + mode);
    if (rb) rb.classList.add('active');
    document.querySelectorAll('.pill-tab').forEach(b => b.classList.toggle('active', b.dataset.mode === mode));
  }
  // Patch setMode to sync rail
  const _sm = window.setMode;
  window.setMode = function(mode) {
    _sm && _sm(mode);
    syncRail(mode);
  };
  // Update AI status
  const _ch = window.checkHealth;
  window.checkHealth = async function() {
    await _ch && _ch();
    setTimeout(() => {
      const badge = document.getElementById('ollamaStatus');
      const ok = badge && badge.className.includes('ok');
      const csp = document.getElementById('cspAiStatus');
      if (csp) {
        csp.textContent = ok ? 'Online âœ“' : 'Offline';
        csp.style.color = ok ? '#10b981' : '#ef4444';
      }
    }, 800);
  };
</script>
</body>
</html>