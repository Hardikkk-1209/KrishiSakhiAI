<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KrishiSakhiAI â€” Smart Farming Assistant</title>
<link rel="stylesheet" href="/static/style.css">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ¾</text></svg>">
</head>

<body>
<div class="app">

<!-- ICON RAIL -->
<nav class="icon-rail">
  <div class="rail-brand">ğŸŒ¾</div>
  <div class="rail-links">
    <button class="rail-btn active" id="rb-chat" onclick="setMode('chat')">
      ğŸ’¬ <span>Chat</span>
    </button>
    <button class="rail-btn" id="rb-livestock" onclick="setMode('livestock')">
      ğŸ„ <span>Livestock</span>
    </button>
  </div>
  <div class="rail-foot">
    <button class="rail-btn" onclick="clearChat()">ğŸ—‘ <span>Clear</span></button>
  </div>
</nav>

<!-- SIDEBAR -->
<aside class="sidebar">

  <div class="sb-header">
    <div class="sb-title">KrishiSakhiAI</div>
    <div class="sb-ver">v2.0</div>
  </div>

  <div id="ollamaStatus" class="status-badge">
    <span class="dot dot-idle"></span>Checkingâ€¦
  </div>

  <div id="farmerSidebar" style="display:none;"></div>

  <div id="modeSelector" style="display:none;">
    <div class="sb-label">Mode</div>
    <div class="seg-group">
      <button class="seg-btn active" onclick="setMode('chat')">ğŸ’¬ Chat</button>
      <button class="seg-btn" onclick="setMode('livestock')">ğŸ„ Livestock</button>
    </div>
  </div>

  <div id="modelSelector" style="display:none;">
    <div class="sb-label">AI Model</div>
    <select id="modelSelect" class="sb-select"></select>
  </div>

  <div id="langSelector" style="display:none;">
    <div class="sb-label">Language</div>
    <select id="langSelect" class="sb-select" onchange="onLangChange()">
      <option value="English">English</option>
      <option value="Hindi">Hindi</option>
      <option value="Marathi">Marathi</option>
    </select>
  </div>

  <div>
    <div class="sb-label">Creativity <span id="tempVal">0.70</span></div>
    <input type="range" min="0" max="1" step="0.05" value="0.7"
           id="temperature"
           oninput="document.getElementById('tempVal').textContent=parseFloat(this.value).toFixed(2)">
  </div>

  <div style="flex:1;"></div>

  <button id="resetProfileBtn" class="sb-btn-danger" style="display:none;" onclick="resetProfile()">
    Reset Profile
  </button>

  <div class="sb-footer">FastAPI Edition</div>

</aside>

<!-- MAIN AREA -->
<main class="main">

<!-- CHAT PAGE -->
<div class="page" id="pageChat">

  <div class="chat-layout">

    <div class="chat-main">

      <div id="chatMessages" class="chat-messages">
        <div class="welcome-box">
          <h2>ğŸ™ Namaste!</h2>
          <p>Your AI-powered farming companion.</p>
        </div>
      </div>

      <div class="chat-bar">
        <input id="chatInput" class="chat-input"
               placeholder="Ask about crops, pests, soil, livestock..."
               onkeydown="if(event.key==='Enter'){sendMessage()}">
        <button id="chatSendBtn" class="btn-send" onclick="sendMessage()">Send</button>
      </div>

    </div>

    <!-- SUMMARY PANEL -->
    <div class="summary-panel">

      <div class="sp-section">
        <div class="sp-title">Farm Overview</div>

        <div class="sp-card">
          <div class="sp-label">Current Season</div>
          <div class="sp-value" id="cspSeasonVal">â€”</div>
        </div>

        <div class="sp-card">
          <div class="sp-label">Your Region</div>
          <div class="sp-value" id="cspRegionVal">â€”</div>
        </div>

        <div class="sp-card">
          <div class="sp-label">AI Status</div>
          <div class="sp-value" id="cspAiStatus">Connectingâ€¦</div>
        </div>

        <!-- WEATHER -->
        <div class="sp-card">
          <div class="sp-label">ğŸŒ¦ Weather</div>
          <div id="weatherMiniTemp">--Â°C</div>
          <div id="weatherMiniDesc">Loading...</div>
          <div>
            ğŸ’§ <span id="weatherMiniHumidity">--%</span>
            |
            ğŸŒ¬ <span id="weatherMiniWind">-- m/s</span>
          </div>
          <div id="weatherMiniAdvice">Checking weather conditions...</div>
        </div>
      </div>

    </div>

  </div>
</div>

<!-- LIVESTOCK PAGE -->
<div class="page" id="pageLivestock">

  <div class="page-topbar">
    <div class="topbar-left">
      <span class="topbar-icon">ğŸ„</span>
      <div>
        <div class="topbar-name">Livestock Biosecurity Hub</div>
        <div class="topbar-sub">AI diagnostics Â· Vaccination Â· Diet Â· Inputs Â· Emergency</div>
      </div>
    </div>
    <div class="topbar-right">
      <div class="pill-tabs">
        <button class="pill-tab" data-mode="chat" onclick="setMode('chat')">ğŸ’¬ Chat</button>
        <button class="pill-tab active" data-mode="livestock" onclick="setMode('livestock')">ğŸ„ Livestock</button>
      </div>
    </div>
  </div>

  <div style="padding:2rem; width:100%;">

    <div class="ls-tabbar">
      <button class="ls-tab active" onclick="switchLsTab(0)">ğŸ”¬ Health Scanner</button>
      <button class="ls-tab" onclick="switchLsTab(1)">ğŸ’‰ Vaccination</button>
      <button class="ls-tab" onclick="switchLsTab(2)">ğŸ¥¬ Feed & Diet</button>
      <button class="ls-tab" onclick="switchLsTab(3)">ğŸšœ Farm Inputs</button>
      <button class="ls-tab" onclick="switchLsTab(4)">ğŸš‘ Emergency Vet</button>
    </div>

    <div class="ls-body">

      <!-- TAB 0 â€” HEALTH SCAN -->
      <div class="ls-panel active" id="lsTab0">

        <div class="scan-toggle-bar">
          <button class="mode-tab active" onclick="switchScanMode('manual',this)">ğŸ“ Manual Input</button>
          <button class="mode-tab" onclick="switchScanMode('csv',this)">ğŸ“ Upload CSV</button>
        </div>

        <div id="scanManual">

          <!-- Physiological -->
          <div class="sensor-block">
            <div class="sensor-block-title">ğŸŒ¡ï¸ Physiological Sensors</div>
            <div class="sensor-grid-5">
              <div class="fg"><label>Body Temp Â°C</label><input type="number" class="fi" id="s_body_temp" value="38.8" step="0.1"></div>
              <div class="fg"><label>Heart Rate bpm</label><input type="number" class="fi" id="s_heart_rate" value="60"></div>
              <div class="fg"><label>Resp. Rate /min</label><input type="number" class="fi" id="s_respiratory_rate" value="22"></div>
              <div class="fg"><label>Activity %</label><input type="number" class="fi" id="s_activity_level" value="68"></div>
              <div class="fg"><label>Milk Yield L/day</label><input type="number" class="fi" id="s_milk_yield" value="20" step="0.5"></div>
            </div>
          </div>

          <!-- Activity -->
          <div class="sensor-block">
            <div class="sensor-block-title">ğŸ”„ Activity & Intake</div>
            <div class="sensor-grid-5">
              <div class="fg"><label>Rumination min</label><input type="number" class="fi" id="s_rumination_min" value="450"></div>
              <div class="fg"><label>Feed Intake kg</label><input type="number" class="fi" id="s_feed_intake" value="22" step="0.5"></div>
              <div class="fg"><label>Water Intake L</label><input type="number" class="fi" id="s_water_intake" value="55"></div>
              <div class="fg"><label>Lying Time hrs</label><input type="number" class="fi" id="s_lying_time" value="12" step="0.5"></div>
              <div class="fg"><label>Steps /day</label><input type="number" class="fi" id="s_steps_count" value="3500"></div>
            </div>
          </div>

          <!-- Gait -->
          <div class="sensor-block">
            <div class="sensor-block-title">ğŸ¦¿ Gait & Environment</div>
            <div class="sensor-grid-5">
              <div class="fg"><label>Gait Score 1â€“5</label><input type="number" class="fi" id="s_gait_score" value="1.2" step="0.1"></div>
              <div class="fg"><label>Stance Symmetry</label><input type="number" class="fi" id="s_stance_symmetry" value="0.95" step="0.01"></div>
              <div class="fg"><label>Stride Length m</label><input type="number" class="fi" id="s_stride_length" value="1.5" step="0.05"></div>
              <div class="fg"><label>Ambient Temp Â°C</label><input type="number" class="fi" id="s_ambient_temp" value="30"></div>
              <div class="fg"><label>Humidity %</label><input type="number" class="fi" id="s_humidity_pct" value="65"></div>
            </div>
          </div>

          <button class="btn-primary w-full" style="margin-top:1rem;" onclick="runScan()">ğŸ”¬ Run Biosecurity Scan</button>

        </div>

        <div id="scanCsv" style="display:none;">
          <div class="upload-box">
            <p>Upload CSV with sensor readings</p>
            <input type="file" accept=".csv" id="csvFile" style="display:none" onchange="uploadCsv()">
            <button class="btn-primary" onclick="document.getElementById('csvFile').click()">ğŸ“¤ Choose CSV</button>
          </div>
        </div>

        <div id="scanResults" style="margin-top:2rem;"></div>

      </div>

      <!-- TAB 1 â€” VACCINATION -->
      <div class="ls-panel" id="lsTab1">
        <div class="w-card">
          <div class="w-card-head">ğŸ’‰ Log Vaccination</div>
          <div class="form-grid-3">
            <div class="fg"><label>Animal ID</label><input class="fi" id="vaxAnimal"></div>
            <div class="fg"><label>Type</label><select class="fi" id="vaxType"><option>Vaccination</option><option>Deworming</option><option>Medicine</option></select></div>
            <div class="fg"><label>Vaccine</label><input class="fi" id="vaxName"></div>
            <div class="fg"><label>Dose</label><input class="fi" id="vaxDose"></div>
            <div class="fg"><label>Date</label><input type="date" class="fi" id="vaxDate"></div>
            <div class="fg"><label>Vet</label><input class="fi" id="vaxVet"></div>
          </div>
          <button class="btn-primary" onclick="saveVax()">ğŸ’¾ Save</button>
        </div>
        <div id="vaxScheduleTable"></div>
        <div id="vaxRecords"></div>
      </div>

      <!-- TAB 2 â€” DIET -->
      <div class="ls-panel" id="lsTab2">
        <div class="w-card">
          <div class="w-card-head">ğŸ¥¬ Daily Diet Log</div>
          <div class="form-grid-3">
            <div class="fg"><label>Animal</label><input class="fi" id="dietAnimal"></div>
            <div class="fg"><label>Date</label><input type="date" class="fi" id="dietDate"></div>
            <div class="fg"><label>Green Fodder kg</label><input type="number" class="fi" id="dietGreen" value="30"></div>
            <div class="fg"><label>Dry Fodder kg</label><input type="number" class="fi" id="dietDry" value="6"></div>
            <div class="fg"><label>Concentrates kg</label><input type="number" class="fi" id="dietConc" value="3"></div>
            <div class="fg"><label>Water L</label><input type="number" class="fi" id="dietWater" value="60"></div>
          </div>
          <button class="btn-primary" onclick="saveDiet()">ğŸ’¾ Save</button>
        </div>
        <div id="dietRefTable"></div>
        <div id="dietRecords"></div>
      </div>

      <!-- TAB 3 â€” FARM INPUTS -->
      <div class="ls-panel" id="lsTab3">
        <div class="w-card">
          <div class="w-card-head">ğŸ§ª Log Pesticide / Fertilizer</div>
          <div class="form-grid-3">
            <div class="fg"><label>Type</label><select class="fi" id="fiType"><option>Pesticide</option><option>Fertilizer</option></select></div>
            <div class="fg"><label>Name</label><input class="fi" id="fiName"></div>
            <div class="fg"><label>Dose</label><input class="fi" id="fiDose"></div>
            <div class="fg"><label>Field</label><input class="fi" id="fiField"></div>
            <div class="fg"><label>Date</label><input type="date" class="fi" id="fiDate"></div>
            <div class="fg"><label>PHI</label><input type="number" class="fi" id="fiPhi" value="14"></div>
          </div>
          <button class="btn-primary" onclick="saveFarmInput()">ğŸ’¾ Save</button>
        </div>
        <div id="mrlTable"></div>
        <div id="farmInputRecords"></div>
      </div>

      <!-- TAB 4 â€” EMERGENCY -->
      <div class="ls-panel" id="lsTab4">
        <div class="w-card">
          <div class="w-card-head">ğŸš‘ Find Nearest Vet</div>
          <input class="fi" id="vetLocation" placeholder="Village / Pincode">
          <button class="btn-primary" onclick="findVet()">ğŸ” Search</button>
          <div id="vetResults"></div>
        </div>
        <div id="firstAidTable"></div>
        <div id="vetResourcesTable"></div>
      </div>

    </div>

  </div>

</div>
</main>
</div>

<script src="/static/app.js"></script>

<script>
function syncRail(mode){
  document.querySelectorAll('.rail-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('rb-'+mode)?.classList.add('active');
}
const _sm = window.setMode;
window.setMode = function(mode){
  _sm && _sm(mode);
  syncRail(mode);
};
</script>

</body>
</html>